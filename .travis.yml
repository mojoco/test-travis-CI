os: osx

language: objective-c

cache:
  directories:
  - .autoconf
  - $HOME/.m2
  - $HOME/flex-sdk
  
before_script:
  # set the JAVA_HOME which is not set by default for OSX Travis-CI workers
  - export "JAVA_HOME=`/usr/libexec/java_home`"
  # Download and install a specific Flash Player from the Adobe Archives:
  # http://helpx.adobe.com/flash-player/kb/archived-flash-player-versions.html
  - sh getFpFromArchive.sh 'http://download.macromedia.com/pub/flashplayer/installers/archive/fp_11.7.700.225_archive.zip'
  - sh getFlexSdk.sh

script: mvn test -DflashPlayer.command=Flash\ Player\ Debugger.app/Contents/MacOS/Flash\ Player\ Debugger

before_deploy:
  
  - echo "==========================================================================="
  - mvn -version  # Apache Maven 3.5.0
#  - ant -version  # PLANTE: command not found
  - echo "==========================================================================="
  - ls $TRAVIS_BUILD_DIR
#  - echo "==========================================================================="
#  - ls $HOME
  - echo "==========================================================================="
  - ls $TRAVIS_BUILD_DIR/target
#  - echo "==========================================================================="
#  - ls $HOME/build/$TRAVIS_REPO_SLUG/target/classes
#  - echo "==========================================================================="
#  - ls $HOME/build/$TRAVIS_REPO_SLUG/target/test-classes

  - echo "==========================================================================="
#  - ls ~
#  - ls ~/.m2
#  - ls ~/.m2/repository
#  - ls ~/.m2/repository/net
#  - ls ~/.m2/repository/org/apache
#  - ls ~/.m2/repository/org/apache/apache
#  - ls ~/.m2/repository/org/apache/commons
#  - ls ~/.m2/repository/org/apache/maven
#  - ls ~/.m2/repository/org/sonatype
#  - ls ~/.m2/repository/com/adobe/flex/compiler
#  - ls ~/.m2/repository/com/adobe/flex/framework
#  - ls ~/.m2/repository/com/adobe/flexunit
  
  - echo "==========================================================================="




# build, package..
# ===========================================================================
  - cd app
  
  - chmod +x _build.command
  - ./_build.command
  
  - chmod +x _package.command
  - ./_package.command

  # zip..
  # ( -y   store symbolic links as the link instead of the referenced file )
  - zip -r -y Main.zip Main.app

  # dmg.. (best compression)
  - hdiutil create -format UDZO -srcfolder Main.app Main.dmg
  - cp Main.dmg $TRAVIS_BUILD_DIR/deploy/github-pages
#===========================================================================



# ?..
# prépare le déploiement ?..
# cars le dossier 'target' disparait !!!
# ===========================================================================
  - mkdir $TRAVIS_BUILD_DIR/_BUILD
  - cp -r $TRAVIS_BUILD_DIR/target/ $TRAVIS_BUILD_DIR/_BUILD

#  - mkdir $TRAVIS_BUILD_DIR/_BUILD/github-pages
#  - cp $TRAVIS_BUILD_DIR/deploy/github-pages/README.md  $TRAVIS_BUILD_DIR/_BUILD/github-pages
#  - cp Main.dmg                                         $TRAVIS_BUILD_DIR/_BUILD/github-pages
  
  - echo "==========================================================================="
  - echo ""
  - echo ""
  - echo ""
  - echo ""
  - echo ""
#  - ls $TRAVIS_BUILD_DIR/_BUILD/github-pages
  - echo ""
  - echo ""
  - echo ""
  - echo ""
  - echo ""
  - ls $TRAVIS_BUILD_DIR/deploy/github-pages
  - echo ""
  - echo ""
  - echo ""
  - echo ""
  - echo ""
  - echo "==========================================================================="
  - echo "==========================================================================="
  
  

deploy:

    # if single-deploy, don't use '-' !
    #   provider: pages
    #
    # if multi-deploy, use list ('-') !
    #   - provider: pages
    #   - provider: releases
    #   - provider: etc..

  # on GitHub Pages..       ( https://docs.travis-ci.com/user/deployment/pages/ )
  # ===========================================================================
#  - provider: pages
  provider: pages
  skip-cleanup: true
  keep-history: true
  github-token: $GITHUB_TOKEN_02
  # local-dir: Directory to push to GitHub Pages, relative to the current directory, defaults to the current directory
  local-dir: deploy/github-pages
  on:
    branch: master

  # on GitHub Release..     ( https://docs.travis-ci.com/user/deployment/releases/ )
  # ===========================================================================
#  - provider: releases
#  api_key: $GITHUB_TOKEN_02
#  file:
#        - Main.dmg
#                       overwrite: true
#  skip_cleanup: true
#  on:
#    tags: true
#    branch: master

